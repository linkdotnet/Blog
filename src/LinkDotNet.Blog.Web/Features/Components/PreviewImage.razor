@using Microsoft.AspNetCore.StaticFiles
@if (string.IsNullOrEmpty(PreviewImageUrlFallback))
{
    <img src="@PreviewImageUrl" alt="Preview image blogpost" loading="@LazyLoadTag"/>
}
else
{
    <picture>
        <source srcset="@PreviewImageUrl" type="@GetMimeType()"/>
        <img src="@PreviewImageUrlFallback" alt="Preview image blogpost" loading="@LazyLoadTag"/>
    </picture>
}

@code {
    [Parameter]
    public string PreviewImageUrl { get; set; }

    [Parameter]
    public string PreviewImageUrlFallback { get; set; }

    [Parameter]
    public bool LazyLoadImage { get; set; }

    private string LazyLoadTag => LazyLoadImage ? "lazy" : "eager";

    private static readonly FileExtensionContentTypeProvider Provider = new();

    static PreviewImage()
    {
        if (!Provider.Mappings.Keys.Contains(".avif"))
        {
            Provider.Mappings.Add(".avif", "image/avif");
        }
    }

    private string GetMimeType()
    {
        Provider.TryGetContentType(PreviewImageUrl, out var contentType);
        return contentType;
    }
}